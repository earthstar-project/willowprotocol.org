<!doctype html><html><head><meta charset="utf-8"></meta><title>Willow Specifications - Willow General Purpose Sync Protocol</title><link rel="stylesheet" href="/styles.css"></head><body><div class="container_main"><main><h1 id="sync" class="wide">Willow General Purpose Sync Protocol</h1><p class="informative">The <a href="/specs\data-model\index.html#data_model">willow data model</a> specifies how to arrange data, but it does not prescribe how peers should synchronize data. In this document, we specify one possible way for performing synchronization: the <dfn><a id="WGPS" href="/specs\sync\index.html#WGPS">Willow General Purpose Sync (WGPS) protocol</a></dfn>. This document assumes familiarity with the <a href="/specs\data-model\index.html#data_model">willow data model</a> and <a href="/specs\meadowcap\index.html#meadowcap">meadowcap</a>.</p><h2 id="sync_intro">Introduction</h2><p class="informative">The WGPS aims to be appropriate for a variety of networking settings, particularly those of peer-to-peer systems where the replicating parties might not necessarily trust each other. Quite a bit of engineering went into the WGPS to satisfy the following requirements:</p><ul><li>Incremental sync: peers can detect regions of shared data with relatively sparse communication to avoid redundant data transfer.</li><li>Partial sync: peers synchronize only those regions of data they both care about, at sub-namespace granularity.</li><li>Access control: conformant peers only hand out data if the request <a href="/specs\meadowcap\index.html#meadowcap">authorizes its access</a>.</li><li>Private set intersection: peers can discover which namespaces they have in common without disclosing any non-common namespaces to each other.</li><li>Resource control: peers communicate (and enforce) their computational resource limits so as not to overload each other.</li><li>Transport independence: peers can communicate over arbitrary reliable, ordered, byte-oriented channels, whether tcp, quic, or unix pipe.</li><li>General efficiency: peers can make use of efficient implementation techniques, and the overall bandwidth consumption stays low.</li></ul><p class="informative">The WGPS provides a shared vocabulary for peers to communicate with, but nothing more. It cannot and does not force peers to use it efficiently or to use the most efficient data structures internally. That's a feature! Implementations can start off with inefficient but simple implementation choices and later replace those with better-scaling ones. Throughout that evolution, the implementations stay compatible with any other implementation, regardless of its degree of sophistication.</p><p class="normative">Throughout this specification, paragraphs styled like this one are normative. Implementations <a href="https://datatracker.ietf.org/doc/html/rfc2119">MUST</a> adhere to all normative content. The other (informative) content is for human eyes only, don't show it to your computer.</p><h2 id="sync_concepts">Concepts</h2><p class="informative">Data synchronization for willow needs to solve a number of sub-problems, which we summarize in this section.</p><h3 id="sync_psi">Private Set Intersection</h3><p class="informative">The WGPS allows two peers to determine which <a class="ref" href="/specs\data-model\index.html#namespace">namespaces</a> they share an interest in without leaking any information about the <a class="ref" href="/specs\data-model\index.html#namespace">namespaces</a> which they do not both know about. We explain the underlying <a href="/specs\sync\psi\index.html#psi">private set intersection protocol here</a>.</p><h3 id="sync_access">Access Control</h3><p class="informative">The WGPS employs the access control mechanism outlined in the <a href="/specs\meadowcap\index.html#meadowcap">meadowcap spec</a>.</p><h3 id="sync_partial">Partial Synchronization</h3><p class="informative">To synchronize data, peers specify any number of <a class="ref" href="/specs\data-model\index.html#aoi">areas of interest</a>. All <a class="ref" href="/specs\data-model\index.html#aoi_empty">non-empty</a> <a class="ref" href="/specs\data-model\index.html#aoi_intersection">intersections</a> of <a class="ref" href="/specs\data-model\index.html#aoi">areas of interest</a> from both peers contain the <a class="ref" href="/specs\data-model\index.html#entry">entries</a> that need to be synchronized.</p><p class="informative">The WGPS synchronizes these <a class="ref" href="/specs\data-model\index.html#aoi_intersection">intersections</a> via <a class="ref" href="/specs\sync\product-based-set-reconciliation\index.html#pbsr">product-based set reconciliation</a>, a technique we <a href="/specs\sync\product-based-set-reconciliation\index.html#product_based_set_reconciliation">explain in detail here</a>.</p><p class="informative">Note that peers need abide to the <a class="ref" href="/specs\data-model\index.html#aoi_count_limit">count limits</a> and <a class="ref" href="/specs\data-model\index.html#aoi_size_limit">size limits</a> of the <a class="ref" href="/specs\data-model\index.html#aoi">areas of interest</a> only on a best-effort basis. Imagine Betty has just transmitted her 100 newest <a class="ref" href="/specs\data-model\index.html#entry">entries</a> to Alfie, only to then receive an even newer <a class="ref" href="/specs\data-model\index.html#entry">entry</a> from Gemma. Betty should forward that <a class="ref" href="/specs\data-model\index.html#entry">entry</a> to Alfie, despite that putting her total number of transmissions above the limit of 100.</p><h3 id="sync_post_sync_forwarding">Post-Reconciliation Forwarding</h3><p class="informative">After performing <a class="ref" href="/specs\sync\product-based-set-reconciliation\index.html#pbsr">set reconciliation</a>, peers might receive new <a class="ref" href="/specs\data-model\index.html#entry">entries</a> that fall into their shared <a class="ref" href="/specs\data-model\index.html#aoi">areas of interest</a>. Hence, the WGPS allows peers to transmit <a class="ref" href="/specs\data-model\index.html#entry">entries</a> unsolicitedly.</p><h3 id="sync_payloads">Payload transmissions</h3><p class="informative">When peers send an <a class="ref" href="/specs\data-model\index.html#entry">entry</a>, they can choose whether to include the full <a class="ref" href="/specs\data-model\index.html#payload">payload</a> or only its <a class="ref" href="/specs\data-model\index.html#payload_hash">hash</a>. Peers exchange <span class="nowrap">preferences<span class="aside_counter">1</span></span><span class="aside"><span class="aside_counter">1</span>These preferences are not binding. The number of <a class="ref" href="/specs\data-model\index.html#aoi_intersection">intersections</a> between the peers' <a class="ref" href="/specs\data-model\index.html#aoi">areas of interest</a> can be quadratic in the number of <a class="ref" href="/specs\data-model\index.html#aoi">areas of interest</a>, and we do not want to mandate keeping a quadratic amount of state.</span> for eager or lazy <a class="ref" href="/specs\data-model\index.html#payload">payload</a> transmission based on <a class="ref" href="/specs\data-model\index.html#payload_length">payload lengths</a> and <a class="ref" href="/specs\data-model\index.html#aoi">areas of interest</a>. These preferences are expressive enough to implement the <a href="https://repositorium.sdum.uminho.pt/bitstream/1822/38894/1/647.pdf">plumtree</a> algorithm.</p><p class="informative">Peers can further explicitly request the <a class="ref" href="/specs\data-model\index.html#payload">payloads</a> of arbitrary <a class="ref" href="/specs\data-model\index.html#entry">entries</a>.</p><h3 id="sync_resources">Resource Limits</h3><p class="informative">Multiplexing and management of shared state require peers to inform each other of their resource limits, lest one peer overloads the other. We describe a protocol-agnostic solution based on <a class="ref" href="/specs\sync\resource-control\index.html#logical_channel">logical channels</a> and <a class="ref" href="/specs\sync\resource-control\index.html#resource_handle">resource handles</a> <a href="/specs\sync\resource-control\index.html#resource_control">here</a>.</p><h2 id="sync_parameters">Parameters</h2></main><footer><nav><ul><li><a href="/">Home</a></li><li><a href="/specs">Specifications</a></li><li><a href="mailto:mail@aljoscha-meyer.de,sam@gwil.garden">Contact us</a></li></ul><p></p><div><span class="aside inline"><a href="https://nlnet.nl"><img src="/assets/nlnet.svg"></img></a></span><p>This project was funded through the NGI Assure Fund, a fund established by NLnet with financial support from the European Commission's Next Generation Internet programme, under the aegis of DG Communications Networks, Content and Technology under grant agreement â„– 957073.</p></div></nav></footer></div></body></html>