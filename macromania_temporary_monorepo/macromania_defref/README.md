# Macromania DefRef

[Macromania](https://github.com/worm-blossom/macromania) macros for defining and referencing concepts and/or numbered elements (sections, theorems, etc).

## Defining and Referencing Concepts

The `<Def/>` macro defines a concept. Use the `<Rb/>` macro to **r**eference it at the **b**eginning of the sentence, and the `<R/>` to **r**eference it elsewhere. References are hyperlinks, this package produces HTML output.

```tsx
<>
  The <Def n="carrot"/> is a vegetable. This <R n="carrot"/> is orange.
  <Rb n="carrot"/> salad is tasty.
</>
```

By default, `<R/>` expands to the name of the concept. You can specify a different `<R/>` expansion with the `r` prop of the `<Def/>` macro:

```tsx
<>
  A <Def n="naive-set" r="set"/> is an unordered collection of objects.
  Here is a <R n="naive-set"/>.{/* renders as "Here is a set." */}
</>
```

By default, `<Rb/>` expands to the same string as `<R/>`, and then calls String.[charAt(0)](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/charAt).[toUpperCase()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/toUpperCase). You can specify an arbitrary `<Rb/>` expansion with the `rb` prop of the `<Def/>` macro:

```tsx
<>
  A <Def n="set" rb="Flubb"/> is an unordered collection of objects.
  <Rb n="set"/> is love.{/* renders as "Flubb is love." */}
</>
```

You can change the function for computing default `<Rb/>` expansions with the `defaultRb` config option; set it to `null` to log a warning whenever an `<Rb/>` macro references a definition that is not explicitly set the `rb` prop:

```tsx
<Config options={[<ConfigDefref defaultRb={null} />]}>
  A <Def n="set"/> is an unordered collection of objects.
  <Rb n="set"/> is love.{/* Logs a warning */}
</Config>
```

### Plural Forms

The `<Def/>` macro can optionally define plural forms; the `rsb` option for the start of sentences, the `rs` option for all other occurrences. The `<Rsb/>` and `<Rs/>` macros then expand to these options respectively.

```tsx
<>
  The <Def n="mouse" rs="mice"/> is an animal.
  Groups of <Rs n="mouse"/> usually organize in representative democracies.
</>
```

Use the `defaultRs` option to set up automatic plural form construction, if your language allows for it. `<Rsb/>` forms are then automatically derived as well.

### Arbitrary Forms

You can always override the display text of both definitions and references by supplying children to these macros:

```tsx
<>
  <Def n="mouse">Mice</Def> are input devices.
  The <R n="mouse" /> and other <R n="mouse">pointer devices</R> are useful.
</>
```

### Other Output Customisation

You can annotate definitions with [classes](https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/class) and [data attributes](https://developer.mozilla.org/en-US/docs/Learn/HTML/Howto/Use_data_attributes); you can further make any reference to a definition be annotated with certain [classes](https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/class) and [data attributes](https://developer.mozilla.org/en-US/docs/Learn/HTML/Howto/Use_data_attributes). To do so, use the `defClass`, `defData`, `refClass` and/or `refData` props of the `<Def/>` macro.

You can arbitrarily change the tag to be used for definitions with the `defTag` prop. By default, the HTML `dfn` is used.

```tsx
<Def
  n="x"
  defTag={(inner: Expression, id: Expression) => {
    return H1({ id, children: inner });
  }}
/>
```

### DefRef and Math Mode

Defref plays nicely with the [macromania-katex](https://github.com/worm-blossom/macromania_katex) package.

Use the `math` prop of the `<Def/>` macro to specify an alternate expansion of the `<R/>` macro inside macromania-katex's `<M>` and `<MM>` macros.

When using `<Def/>` inside a `<M>` or `<MM>` macro, its default expansion is taken to be intended for math mode. References outside math mode then get automatically wrapped in a `<M>` macro.

### Numbered References

DefRef supports generating numbered references, such as "Section 3.1" or "Theorem 2". These are generated by a separate set of referencing macros, but definitions still use the `<Def />` macro. This way, a section might be reference either by number or by title, for example.

A `<Def />` can be used for numbered references if it specifies the `numbering` prop. We expect such definitions to be primarily macro-generated rather than hand-written, so the API is less convenient and fine-grained than the API for regular refs. The `numbering` prop consists of a `NumberingInfo`, and a numbering (an array of numbers).

Each `NumberingInfo` specifies the category ("Section", "Theorem", etc.) as it should be rendered at the beginning of a sentence or elsewhere, in plural or singular. Additionally, a function specifies how to render the numbering into an Expression. The `NumberingInfo` objects are never mutated, so they can be shared across many definitions of the same kind.

```tsx
<>
  <Def n="physics" r="Nuclear Physics for Dummies" numbering={{
    numbering: [2, 1],
    info: {
      r: "section",
      rb: "Section",
      rs: "sections",
      rsb: "Sections",
      render: (ctx, numbering) => numbering.join("."),
    },
  }}>Section 2.1: Nuclear Physics for Dummies</Def>
</>
```

Given such a definition, the `<Rc/>` macro can reference the definition by number; the `<Rcb/>` macro should be used at the beginning of sentences.

```tsx
<>
  See <Rc n="physics" /> (<R n="physics" />).
  {/* See section 2.1 (Nuclear Physics for Dummies). */}
</>
```

The `<Rc/>` and `<Rcb/>` macros take an optional `render` prop to override how to render the numbering for a particular ref. If the macros have children, the children replace the category part of the output:

```tsx
<>
  <Rcb n="physics" render={(ctx, numbering) => "Frob"} /> {/* Section Frob */}
  <Rcb n="physics">Glub</Rcb> {/* Glub 2.1 */}
  <Rcb n="physics" render={(ctx, numbering) => "Frob"}>Glub</Rcb> {/* Glub Frob */}
</>
```

Notice that the plural forms of categories are never used right now. Future versions of this package will support numbered references to several definitions at once (compare the Latex [cleveref package](https://ctan.org/pkg/cleveref?lang=en)); rendering these will require plural forms.
